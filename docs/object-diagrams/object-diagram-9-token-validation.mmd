---
%% 9. TOKEN VALIDATION - OBJECT DIAGRAM
%% Shows object states during JWT token validation
---

classDiagram
    class httpRequest["httpRequest: HttpServletRequest"] {
        method: "GET"
        path: "/api/auth/validate"
        Authorization: "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
    }
    
    class authHeader["authHeader: String"] {
        value: "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
        hasBearer: true
        length: "200+ chars"
    }
    
    class extractedToken["extractedToken: String"] {
        value: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
        parts: "header, payload, signature"
    }
    
    class tokenHeader["tokenHeader: JSON"] {
        alg: "HS256"
        typ: "JWT"
    }
    
    class tokenPayload["tokenPayload: Claims"] {
        sub: "john"
        roles: "ROLE_USER"
        iat: 1735508400
        exp: 1735594800
    }
    
    class tokenSignature["tokenSignature: String"] {
        value: "SflKxwRJSMeKKF2QT4fwpMeJf36POk6yJV_adQssw5c"
        algorithm: "HMAC-SHA256"
    }
    
    class secretKey["secretKey: SecretKey"] {
        value: "my-super-secret-jwt-key-that-is-at-least-256-bits"
        algorithm: "HmacSHA256"
        encoded: true
    }
    
    class verificationProcess["verificationProcess: Validation"] {
        signatureValid: "true"
        notExpired: "true"
        notBefore: "true"
        formatValid: "true"
        result: "VALID"
    }
    
    class validationResult["validationResult: Map"] {
        valid: true
    }
    
    %% Alternative - Invalid Token Scenario
    class expiredToken["expiredToken: Claims"] {
        sub: "alice"
        exp: 1735422000
        currentTime: 1735508400
        isExpired: true
    }
    
    class expiredValidation["expiredValidation: Validation"] {
        signatureValid: true
        notExpired: "false (EXPIRED)"
        result: "INVALID"
    }
    
    class invalidResult["invalidResult: Map"] {
        valid: false
        error: "Token has expired"
    }
    
    class responseEntity["responseEntity: ResponseEntity"] {
        status: "200 OK"
        body: "validationResult | invalidResult"
    }
    
    %% Relationships - Valid Token Flow
    httpRequest --> authHeader : "extracts header"
    authHeader --> extractedToken : "removes Bearer prefix"
    extractedToken --> tokenHeader : "decodes header"
    extractedToken --> tokenPayload : "decodes payload"
    extractedToken --> tokenSignature : "extracts signature"
    tokenHeader --> verificationProcess : "checks structure"
    tokenPayload --> verificationProcess : "checks claims"
    tokenSignature --> verificationProcess : "checks signature"
    secretKey --> verificationProcess : "used for verification"
    verificationProcess --> validationResult : "if valid"
    
    %% Alternative - Expired Token
    expiredToken -.-> expiredValidation : "expired check"
    expiredValidation -.-> invalidResult : "returns error"
    
    validationResult --> responseEntity : "valid response"
    invalidResult -.-> responseEntity : "invalid response"
    
    note for verificationProcess "Signature + Expiry + Format validation"
    note for validationResult "Token valid, access granted"
    note for invalidResult "Token invalid, login required"
