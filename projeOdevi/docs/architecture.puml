@startuml Mikroservis Mimarisi

!define RECTANGLE class

skinparam backgroundColor #f5f5f5
skinparam componentStyle rectangle
skinparam defaultFontSize 12

title Spring Boot Mikroservis Mimarisi

actor "Client\n(Web/Mobile)" as client

cloud "Docker Compose (Local/Dev)" {

    package "API Gateway\n:8080" as gateway #orange {
        [Spring Cloud Gateway]
        [JWT Validation Filter]
        [Rate Limiting (in-memory)]
    }

    package "Service Discovery\n:8761" as eureka #lightgreen {
        [Eureka Server]
    }

    package "Auth Service\n:8081" as auth #lightyellow {
        [AuthController]
        [JwtUtil]
        [Actuator / Prometheus]
    }

    package "User Service\n:8082" as user #lightpink {
        [UserController]
        [Actuator / Prometheus]
    }

    database "MySQL\n:3306" as mysql #lightgray {
        [authdb]
        [userdb]
    }

    package "Observability" as obs #aliceblue {
        [Prometheus\n:9090] as prom
        [Grafana\n:3001] as graf
        [Loki\n:3100] as loki
        [Promtail] as promtail
    }
}

client --> gateway : HTTPS/HTTP

gateway --> auth : /api/auth/**
gateway --> user : /api/users/**

auth ..> eureka : Register
user ..> eureka : Register
gateway ..> eureka : Discover services

auth --> mysql : JPA/Hibernate
user --> mysql : JPA/Hibernate

prom --> gateway : scrape /actuator/prometheus
prom --> auth : scrape /actuator/prometheus
prom --> user : scrape /actuator/prometheus
prom --> eureka : scrape /actuator/prometheus

promtail --> loki : push logs
graf --> prom : metrics queries
graf --> loki : logs queries

note right of gateway
  **API Gateway Özellikleri:**
  - Merkezi giriş noktası
  - JWT Token doğrulama
  - Rate limiting
  - Load balancing
end note

note right of auth
  **Auth Endpoints:**
  - POST /api/auth/register
  - POST /api/auth/login
  - GET /api/auth/validate
  - GET /api/auth/me
end note

note right of user
  **User Endpoints (CRUD):**
  - GET /api/users
  - GET /api/users/{id}
  - POST /api/users
  - PUT /api/users/{id}
  - DELETE /api/users/{id}
end note

@enduml
